#import "styles.typ": flight-plan, flight-plan-table, info-table
#import "helpers.typ": *

#show: flight-plan

= Module <%= @module_number %>: <%= @module_name %>

== Overview

#info-table(
  date: "19 June 2024",
  time: "0900 UTC",
  duration: <%= @total_length %>,
  organisation: "<%= @organisation %>",
)

BOR = breakout rooms, Fx = facilitator, Px = producer

#bcf-nom[Yellow highlighted text] indicates where names, contact details, examples, timings etc. might need to be changed

#bcf-mod[Green highlighted text] indicates modifications to the live/master version for the session

#bcf-atten[Bold text] in time plan draws attention to facilitator script

#bcf-cue[Bold highlighted text] helps provide cues for producer to paste chat text

#pagebreak()

= Flight Plan

== Learning Outcomes

<%= @learning_outcomes %>

== Flipcharts

#[
// Bold titles.
#show table.cell.where(y: 0): set text(weight: "bold")

#table(
columns: (auto, auto, 1fr),
rows: 4,
align: (x, y) =>
if y > 0 and x == 2 { left }
else { center },

[Reference], [Who is scribing?], [Contents],

<% flipcharts.each do |flipchart| %>
  [#("<%= flipchart.pretty_id %>")], [<%= flipchart.pretty_scribed_by %>], [<%= flipchart.description %>],
<% end %>
)
]

== Demo

<%= @demo %>

#pagebreak()

== Time Plan

#flight-plan-table(
<%
  current_speaker = nil
  current_time = self.initial_time
%>

<% blocks.each do |block| %>
  <% table_row = block.table_row %>
  <% if block.speaker != current_speaker %>
    <% if current_speaker.nil? %>
      speaker-swap[<%= format_speakers(block.speaker) %>],
    <% else %>
      speaker-swap[Switch to <%= format_speakers(block.speaker) %>],
    <% end %>
  <% end %>

  [<%= current_time.to_s.rjust(2, "0") %>],
  [<%= table_row.length %>],
  [<%= table_row.section_info %>],
  [<%= table_row.facilitator_content %>],
  [<%= table_row.producer_content %>],

  <%
    current_speaker = block.speaker
    current_time += block.length
  %>
<% end %>
)

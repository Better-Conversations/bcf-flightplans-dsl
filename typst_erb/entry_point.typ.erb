#import "template.typ": flight-plan, flight-plan-table, instruction, chat, spoken, speaker-swap
#import "helpers.typ": *

#show: doc => flight-plan(
module_number: <%= @module_number %>,
module_name: "<%= @module_name %>",
duration: <%= @total_length %>,
when: datetime(
year: 2024,
month: 6,
day: 19,
hour: 9,
minute: 0,
second: 0,
),
organisation: "Better Conversations Foundation",
doc
)

= Flight Plan

== Learning Outcomes

<%= @learning_outcomes %>

== Flipcharts

#[
// Bold titles.
#show table.cell.where(y: 0): set text(weight: "bold")

#table(
columns: (auto, auto, 1fr),
rows: 4,
align: (x, y) =>
if y > 0 and x == 2 { left }
else { center },

[Reference], [Who is scribing?], [Contents],

<% flipcharts.each_with_index do |flipchart, index| %>
  [#("<%= flipchart.pretty_id %>")], [<%= flipchart.pretty_scribed_by %>], [<%= flipchart.description %>],
<% end %>
)
]

== Demo

<%= @demo %>

#pagebreak()

== Time Plan

#flight-plan-table(
<%
  current_speaker = nil
  current_time = self.initial_time
%>

<% blocks.each do |block| %>
  <% table_row = block.table_row %>
  <% if block.speaker != current_speaker %>
    <% if current_speaker.nil? %>
      speaker-swap[<%= format_speakers(block.speaker) %>],
    <% else %>
      speaker-swap[Switch to <%= format_speakers(block.speaker) %>],
    <% end %>
  <% end %>

  [<%= current_time.to_s.rjust(2, "0") %>],
  [<%= table_row.length %>],
  [<%= table_row.section_info %>],
  [<%= table_row.facilitator_content %>],
  [<%= table_row.producer_content %>],

  <%
    current_speaker = block.speaker
    current_time += block.length
  %>
<% end %>
)
